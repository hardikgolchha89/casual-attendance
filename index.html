<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Attendance Scanner</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' ry='12' fill='%23005cff'/%3E%3Cpath d='M18 34 l8 8 l20 -20' fill='none' stroke='white' stroke-width='6' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
    <!-- html5-qrcode (local vendored) -->
    <script src="vendor/html5-qrcode.min.js"></script>
  </head>
  <body>
    <div class="app">
      <header class="app__header">
        <h1>Attendance Scanner</h1>
      </header>
      <main class="app__main">
        <nav class="tabs" aria-label="Primary">
          <div class="tabs__list" role="tablist">
            <button class="tabs__btn is-active" role="tab" aria-selected="true" aria-controls="section-scan" id="tab-scan">Scan</button>
            <button class="tabs__btn" role="tab" aria-selected="false" aria-controls="section-generate" id="tab-generate">Generate</button>
            <button class="tabs__btn" role="tab" aria-selected="false" aria-controls="section-analytics" id="tab-analytics">Analytics</button>
          </div>
        </nav>

        <section id="section-scan" class="tab-panel is-active" role="tabpanel" aria-labelledby="tab-scan">
          <div class="site-control">
            <label for="site-input" class="site-control__label">Site (optional)</label>
            <input id="site-input" class="input" type="text" placeholder="e.g., Site A">
          </div>
          <div class="actions">
            <button id="btn-checkin" class="btn btn--primary">Check In</button>
            <button id="btn-checkout" class="btn btn--secondary">Check Out</button>
          </div>
        </section>

        <section id="section-generate" class="tab-panel" role="tabpanel" aria-labelledby="tab-generate">
          <div class="qrgen">
          <h2 class="qrgen__title">Quick QR Generator</h2>
          <div class="qrgen__form">
            <input id="qrgen-name" class="input" type="text" placeholder="Name (e.g., John Doe)">
            <input id="qrgen-location" class="input" type="text" placeholder="Location (e.g., Site A)">
            <div class="qrgen__actions">
              <button id="qrgen-generate" class="btn btn--primary">Generate</button>
              <button id="qrgen-download" class="btn btn--secondary" disabled>Download PNG</button>
            </div>
          </div>
          <div id="qrgen-preview" class="qrgen__preview"></div>
          </div>

          <div class="qrgen">
          <h2 class="qrgen__title">Bulk QR Generator</h2>
          <div class="qrgen__form">
            <input id="bulk-file" class="input" type="file" accept=".csv,.tsv,.txt">
            <textarea id="bulk-text" class="input input--textarea" placeholder="Name,Location\nAlice,Site A\nBob,Site B\nCharlie,Site C"></textarea>
            <div class="qrgen__actions">
              <button id="bulk-generate" class="btn btn--primary">Generate ZIP</button>
            </div>
          </div>
          </div>
        </section>

        <section id="section-analytics" class="tab-panel" role="tabpanel" aria-labelledby="tab-analytics">
          <div class="analytics">
            <h2 class="analytics__title">Today</h2>
            <div class="analytics__kpis">
              <div class="kpi"><div class="kpi__label">Check-ins</div><div class="kpi__value" id="kpi-ins">0</div></div>
              <div class="kpi"><div class="kpi__label">Check-outs</div><div class="kpi__value" id="kpi-outs">0</div></div>
              <div class="kpi"><div class="kpi__label">Total</div><div class="kpi__value" id="kpi-total">0</div></div>
            </div>

            <div class="analytics__grid">
              <div class="card">
                <div class="card__title">By Location (Today)</div>
                <div id="table-loc-today" class="table"></div>
              </div>
              <div class="card">
                <div class="card__title">By Location (Last 7 Days)</div>
                <div id="table-loc-7d" class="table"></div>
              </div>
            </div>

            <div class="card">
              <div class="card__title">Recent Scans</div>
              <div id="recent-list" class="recent"></div>
            </div>
            <div class="analytics__actions">
              <button id="btn-refresh-stats" class="btn btn--ghost">Refresh</button>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Scanner Modal -->
    <div id="scanner-modal" class="modal" aria-hidden="true">
      <div class="modal__backdrop" id="scanner-backdrop"></div>
      <div class="modal__dialog" role="dialog" aria-modal="true" aria-label="QR Scanner">
        <div class="modal__header">
          <div class="modal__title" id="scanner-title">Scan QR</div>
          <button id="scanner-close" class="icon-button" aria-label="Close">âœ•</button>
        </div>
        <div class="modal__body">
          <div class="camera-picker">
            <label for="camera-select" class="camera-picker__label">Camera</label>
            <select id="camera-select" class="camera-picker__select"></select>
          </div>
          <div class="camera-controls">
            <button id="torch-toggle" class="btn btn--ghost camera-controls__btn" aria-pressed="false">Torch</button>
            <div id="zoom-group" class="camera-controls__zoom">
              <label for="zoom-range" class="camera-controls__label">Zoom</label>
              <input id="zoom-range" type="range" min="1" max="1" step="0.1" value="1" />
            </div>
          </div>
          <div id="qr-reader"></div>
          <div class="modal__hint">Point your camera at the worker ID QR code.</div>
          <button id="scanner-cancel" class="btn btn--ghost">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Toasts -->
    <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <script src="vendor/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="src/main.js" type="module"></script>
  </body>
  </html>
